@model string

@{    
    IEnumerable<SelectListItem> selectList = (IEnumerable<SelectListItem>) ViewData["selectList"] ?? new SelectListItem[] { };
    bool? isMultiple = ViewData["multiple"] as bool?;
    string multiple = isMultiple.HasValue ? (isMultiple.Value?"multiple":"") : "";
}

    <select class="selectpicker show-tick form-control" @multiple data-selected-text-format="count>3" data-show-content="false" data-multiple-separator=" | ">
        
        @if(selectList.Select(s => s.Group!=null).Count()>0)
        {

            //foreach (var group in selectList.Select(s => s.Group).OfType<SelectListGroup>().Distinct())
            foreach (var group in selectList.Where(s => s.Group!=null).GroupBy(s => s.Group.Name))
            {
                <optgroup label="@group.First().Group.Name" disabled="@group.First().Group.Disabled">
                    @*@foreach (SelectListItem option in selectList.Where(s => s.Group == null))*@
                    @foreach(var option in group)
                    {
                        <option disabled="@option.Disabled" @(option.Selected?"selected":"") value="@option.Value">@option.Text</option>
                    }
                </optgroup>
            }
        }
        @foreach (SelectListItem option in selectList.Where(s => s.Group == null))
        {
            <option disabled="@option.Disabled" @(option.Selected ? "selected" : "") value="@option.Value">@option.Text</option>
        }
        <option data-divider="true"></option>
        <option class="additem"
                data-content="<input type=text onKeyDown='event.stopPropagation();'.
    onKeyPress='addSelectInpKeyPress(this,event)' onClick='event.stopPropagation()' placeholder='Add item'>
    <span class='glyphicon glyphicon-plus addnewicon' onClick='addSelectItem(this,event,1);'></span>"></option>
    </select>